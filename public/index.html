<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Trading Agent Dashboard</title>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
body{
  background:#111;
  color:white;
  font-family:Arial;
  padding:20px;
}
.card{
  background:#1a1a1a;
  padding:15px;
  margin:15px 0;
  border-radius:8px;
}
table{
  width:100%;
  border-collapse:collapse;
}
td,th{
  padding:8px;
  border-bottom:1px solid #333;
}
h1,h2{margin-top:0}
</style>
</head>

<body>

<h1>üöÄ Trading Agent Dashboard</h1>
<div id="updated">Loading...</div>

<div class="card">
<h2>üìà Equity Curves</h2>
<div id="equityChart"></div>
</div>

<div class="card">
<h2>üìä Strategy Metrics</h2>
<table id="metricsTable"></table>
</div>

<div class="card">
<h2>üéØ Today's Signals</h2>
<div id="signals"></div>
</div>

<div id="error" style="color:#ff6b6b"></div>

<script>

const JSON_URL =
"https://trading-agent-bot.pages.dev/public/dashboard_data.json?v=" + Date.now();

fetch(JSON_URL)
.then(r=>{
    if(!r.ok) throw new Error("HTTP "+r.status);
    return r.json();
})
.then(d=>{

console.log("DATA LOADED:", d)

// -------- updated time --------
document.getElementById("updated").innerText =
"Updated: " + d.timestamp;


// -------- equity chart --------
let traces = [];

for(const key in d.equity){
    traces.push({
        y: d.equity[key],
        mode: 'lines',
        name: d.strategies[key]?.name || key
    });
}

Plotly.newPlot("equityChart", traces, {
    paper_bgcolor:"#111",
    plot_bgcolor:"#111",
    font:{color:"white"}
});


// -------- metrics table --------
let html = `
<tr>
<th>Strategy</th>
<th>Return %</th>
<th>Sharpe</th>
<th>Win Rate</th>
<th>Profit Factor</th>
</tr>`;

for(const key in d.strategies){
    const s = d.strategies[key];
    const m = s.metrics;

    html += `<tr>
    <td>${s.name}</td>
    <td>${(m.return_pct ?? 0).toFixed(2)}</td>
    <td>${(m.sharpe ?? 0).toFixed(2)}</td>
    <td>${((m.win_rate ?? 0)*100).toFixed(1)}%</td>
    <td>${(m.profit_factor ?? 0).toFixed(2)}</td>
    </tr>`;
}

document.getElementById("metricsTable").innerHTML = html;


// -------- signals --------
let sigHTML = "";

for(const strat in d.signals){
    sigHTML += "<b>"+strat+"</b><br>";

    d.signals[strat].forEach(x=>{
        sigHTML +=
        `${x.symbol} | ${x.side} | SL ${x.stop_loss}<br>`;
    });

    sigHTML += "<br>";
}

document.getElementById("signals").innerHTML = sigHTML;

})
.catch(e=>{
    console.error(e);
    document.getElementById("error").innerText =
    "‚ùå ERROR: " + e;
});

</script>

</body>
</html>
