<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Trading Agent Dashboard</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
body{background:#111;color:white;font-family:Arial;padding:20px}
.card{background:#1a1a1a;padding:15px;margin:15px 0;border-radius:8px}
table{width:100%;border-collapse:collapse}
td,th{padding:8px;border-bottom:1px solid #333}
</style>
</head>

<body>

<h1>ğŸš€ Trading Agent Dashboard</h1>
<div id="updated">Loading...</div>

<div class="card">
<h2>ğŸ“ˆ Equity Curves</h2>
<div id="equityChart"></div>
</div>

<div class="card">
<h2>ğŸ“Š Strategy Metrics</h2>
<table id="metricsTable"></table>
</div>

<div class="card">
<h2>ğŸ¯ Today's Signals</h2>
<div id="signals"></div>
</div>

<div id="error" style="color:#ff6b6b"></div>

<script>

fetch("/dashboard_data.json?v="+Date.now())
.then(r=>{
    if(!r.ok) throw new Error("HTTP "+r.status);
    return r.json();
})
.then(d=>{

document.getElementById("updated").innerText =
"Updated: "+d.timestamp;


// EQUITY
let traces=[];
for(const k in d.equity){
    traces.push({
        y:d.equity[k],
        mode:'lines',
        name:d.strategies[k]?.name || k
    });
}

Plotly.newPlot("equityChart", traces, {
    paper_bgcolor:"#111",
    plot_bgcolor:"#111",
    font:{color:"white"}
});


// METRICS
let html=`<tr>
<th>Strategy</th>
<th>Return%</th>
<th>Sharpe</th>
<th>WinRate</th>
<th>PF</th>
</tr>`;

for(const k in d.strategies){
    let s=d.strategies[k];
    let m=s.metrics;

    html+=`<tr>
    <td>${s.name}</td>
    <td>${(m.total_return_pct??0).toFixed(2)}</td>
    <td>${(m.sharpe_ratio??0).toFixed(2)}</td>
    <td>${(m.win_rate??0).toFixed(1)}%</td>
    <td>${(m.profit_factor??0).toFixed(2)}</td>
    </tr>`;
}

document.getElementById("metricsTable").innerHTML=html;


// SIGNALS
let sig="";
for(const strat in d.signals){
    sig+="<b>"+strat+"</b><br>";
    d.signals[strat].forEach(x=>{
        sig+=`${x.ticker||x.symbol} | ${x.action||x.side} <br>`;
    });
    sig+="<br>";
}

document.getElementById("signals").innerHTML=sig;

})
.catch(e=>{
document.getElementById("error").innerText="âŒ "+e;
});

</script>

</body>
</html>
