<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Trading Agent Dashboard</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
  body { background:#111; color:white; font-family:Arial, sans-serif; padding:20px;}
  h1,h2,h3 { color:#FFD700; }
  table { border-collapse: collapse; margin-bottom:20px; width:100%; }
  th, td { border:1px solid #555; padding:5px 10px; text-align:center; }
  th { background:#222; }
  td { background:#111; }
  .section { margin-bottom:40px; }
</style>
</head>
<body>

<h1>üöÄ Trading Agent Dashboard</h1>
<div id="updated">Loading...</div>

<div class="section">
<h2>üìà Equity Curves</h2>
<div id="equity_chart" style="height:500px;"></div>
</div>

<div class="section">
<h2>üìä Strategy Metrics</h2>
<table id="metrics_table"></table>
</div>

<div class="section">
<h2>üéØ Today's Signals</h2>
<div id="signals"></div>
</div>

<div class="section">
<h2>üîç Backtest vs Actual</h2>
<div id="backtest_diff"></div>
</div>

<script>
fetch("dashboard_data.json")
.then(r=>r.json())
.then(d=>{
  // Timestamp
  document.getElementById("updated").innerText = "Updated: " + d.timestamp;

  // --- Equity Curves ---
  let traces=[];
  for(const [k,e] of Object.entries(d.equity)){
    traces.push({ y:e, mode:'lines+markers', name:d.strategies[k]?.name||k });
  }
  Plotly.newPlot("equity_chart", traces, {
    plot_bgcolor:"#111", paper_bgcolor:"#111", font:{color:"white"},
    title:"Equity Curves", xaxis:{title:"Day"}, yaxis:{title:"Equity ($)"}
  });

  // --- Strategy Metrics Table ---
  let metrics_html=`<tr>
    <th>Strategy</th>
    <th>Total Profit</th>
    <th>Return %</th>
    <th>Trades</th>
    <th>Win Rate</th>
    <th>Avg Win</th>
    <th>Avg Loss</th>
    <th>Sharpe</th>
    <th>Max DD</th>
    <th>PF</th>
  </tr>`;
  for(const k in d.strategies){
    let s=d.strategies[k];
    let m=s.metrics;
    metrics_html+=`<tr>
      <td>${s.name}</td>
      <td>$${(m.total_profit??0).toFixed(2)}</td>
      <td>${(m.total_return_pct??0).toFixed(2)}%</td>
      <td>${(m.trades??0)}</td>
      <td>${(m.win_rate??0).toFixed(1)}%</td>
      <td>$${(m.avg_win??0).toFixed(2)}</td>
      <td>$${(m.avg_loss??0).toFixed(2)}</td>
      <td>${(m.sharpe_ratio??0).toFixed(2)}</td>
      <td>${(m.max_drawdown??0).toFixed(2)}%</td>
      <td>${(m.profit_factor??0).toFixed(2)}</td>
    </tr>`;
  }
  document.getElementById("metrics_table").innerHTML = metrics_html;

  // --- Today's Signals ---
  let sig_html="";
  for(const strat in d.signals){
    sig_html+="<b>"+strat+" - "+(d.strategies[strat]?.name||strat)+"</b><br>";
    d.signals[strat].forEach(x=>{
      sig_html+=`${x.ticker||x.symbol} | ${x.action||x.side} | Alloc: $${x.alloc??0} | SL: ${x.sl??0}`;
      if(x.zscore) sig_html+=` | Z-Score: ${x.zscore.toFixed(2)}`;
      if(x.prev_return) sig_html+=` | Prev Return: ${x.prev_return.toFixed(2)}%`;
      sig_html+="<br>";
    });
    sig_html+="<br>";
  }
  document.getElementById("signals").innerHTML = sig_html;

  // --- Backtest vs Actual ---
  let bt_html="";
  if(d.backtest){
    for(const strat in d.backtest){
      let bt=d.backtest[strat];
      bt_html+=`<b>${strat} - ${d.strategies[strat]?.name||strat}</b><br>`;
      bt_html+=`Backtest: Profit=$${bt.backtest_profit.toFixed(2)} | Return=${bt.backtest_return_pct.toFixed(2)}% | Sharpe=${bt.backtest_sharpe.toFixed(2)} | Trades=${bt.backtest_trades}<br>`;
      bt_html+=`Actual  : Profit=$${bt.actual_profit.toFixed(2)} | Return=${bt.actual_return_pct.toFixed(2)}% | Sharpe=${bt.actual_sharpe.toFixed(2)} | Trades=${bt.actual_trades}<br>`;
      bt_html+=`Diff    : $${bt.diff_profit.toFixed(2)} (${bt.diff_pct.toFixed(1)}%)<br><br>`;
    }
    document.getElementById("backtest_diff").innerHTML = bt_html;
  } else {
    document.getElementById("backtest_diff").innerHTML = "Backtest vs Actual data not available";
  }

})
.catch(e=>{
  document.getElementById("updated").innerText = "‚ùå ERROR: "+e;
});
</script>

</body>
</html>
