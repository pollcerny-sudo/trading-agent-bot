<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Trading Agent Dashboard V3</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
body{background:#0f0f0f;color:#eee;font-family:Arial;padding:20px}
table{border-collapse:collapse;width:100%}
th,td{border:1px solid #333;padding:6px;text-align:center}
th{background:#222}
h2{margin-top:40px}
.card{background:#1a1a1a;padding:15px;margin:10px 0;border-radius:8px}
.small{font-size:12px;color:#aaa}
</style>
</head>

<body>

<h1>üöÄ Trading Agent Dashboard ‚Äî V3</h1>
<div id="updated">Loading...</div>

<h2>üìä Strategy Metrics</h2>
<table id="metrics"></table>

<h2>üìà Equity Curves</h2>
<div id="equityChart"></div>

<h2>üèÜ Strategy Ranking</h2>
<div id="rankingChart"></div>

<h2>üéØ Signals</h2>
<div id="signals"></div>

<script>

fetch("dashboard_data.json")
.then(r=>r.json())
.then(d=>{

// ================= TIMESTAMP
updated.innerText = "Updated: "+d.timestamp


// ================= METRICS TABLE

let mhtml = `
<tr>
<th>Strategy</th>
<th>Profit</th>
<th>Return %</th>
<th>Trades</th>
<th>Win %</th>
<th>Avg Win</th>
<th>Avg Loss</th>
<th>Sharpe</th>
<th>MaxDD %</th>
<th>PF</th>
</tr>`

let profits=[]
let names=[]

for(const [code,s] of Object.entries(d.strategies)){

let m = s.metrics

mhtml += `
<tr>
<td>${code} ‚Äî ${s.name}</td>
<td>${m.total_profit.toFixed(2)}</td>
<td>${m.total_return_pct.toFixed(2)}</td>
<td>${m.num_trades}</td>
<td>${m.win_rate.toFixed(1)}</td>
<td>${m.avg_win.toFixed(2)}</td>
<td>${m.avg_loss.toFixed(2)}</td>
<td>${m.sharpe_ratio.toFixed(2)}</td>
<td>${m.max_drawdown_pct.toFixed(2)}</td>
<td>${m.profit_factor.toFixed(2)}</td>
</tr>
`

profits.push(m.total_profit)
names.push(code)
}

metrics.innerHTML = mhtml


// ================= EQUITY CURVES

if(d.equity){

let traces=[]

for(const [k,e] of Object.entries(d.equity)){
traces.push({
y:e,
mode:'lines',
name:k
})
}

Plotly.newPlot("equityChart", traces,
{paper_bgcolor:"#111",plot_bgcolor:"#111",font:{color:"#eee"}})

}


// ================= RANKING BAR

Plotly.newPlot("rankingChart", [{
x:names,
y:profits,
type:'bar'
}],
{paper_bgcolor:"#111",plot_bgcolor:"#111",font:{color:"#eee"}})


// ================= SIGNALS DETAIL

let shtml=""

for(const [code,list] of Object.entries(d.signals)){

let stratName = d.strategies[code]?.name || code

shtml += `<div class="card"><b>${code} ‚Äî ${stratName}</b><br>`

list.forEach(x=>{

shtml += `
${x.ticker} | ${x.action}
| SL ${x.sl_factor}
| Alloc $${x.allocation_usd}
`

if(x.z_score!=null)
shtml += ` | Z ${x.z_score}`

if(x.prev_return_pct!=null)
shtml += ` | Prev ${x.prev_return_pct}%`

if(x.vol_ratio!=null)
shtml += ` | Vol ${x.vol_ratio}`

if(x.ticker_group)
shtml += ` <span class="small">(${x.ticker_group})</span>`

shtml += "<br>"
})

shtml += "</div>"
}

signals.innerHTML = shtml


})
.catch(e=>{
document.body.innerHTML += "<h2>‚ùå ERROR: "+e+"</h2>"
})

</script>

</body>
</html>
